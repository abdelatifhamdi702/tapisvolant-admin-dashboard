<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="TechyDevs" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Tapis volant</title>
    <!-- Favicon -->
    <link rel="icon" href="images/logo.jpg" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Template CSS Files -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="css/line-awesome.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="css/daterangepicker.css" />
    <link rel="stylesheet" href="css/animate.min.css" />
    <link rel="stylesheet" href="css/animated-headline.css" />
    <link rel="stylesheet" href="css/jquery-ui.css" />
    <link rel="stylesheet" href="css/flag-icon.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/alertUI.css" />

  </head>

  <body class="section-bg">
    <!-- start cssload-loader -->
    <div class="preloader" id="preloader">
      <div class="loader">
        <svg class="spinner" viewBox="0 0 50 50">
          <circle
            class="path"
            cx="25"
            cy="25"
            r="20"
            fill="none"
            stroke-width="5"
          ></circle>
        </svg>
      </div>
    </div>
    <!-- end cssload-loader -->

    
<!-- ================================
       START DASHBOARD NAV
================================= -->
<div class="sidebar-nav sidebar--nav">
  <div class="sidebar-nav-body">
    <div class="side-menu-close">
      <i class="la la-times"></i>
    </div>
    <!-- end menu-toggler -->
    <div class="author-content">
      <div class="d-flex align-items-center">
        <div class="author-img avatar-sm">
          <img src="images/team9.jpg" class="ProfileAI" alt="testimonial image" />
        </div>
        <div class="author-bio">
          <h4 class="author__title AgentnameAI3">Royel travel agency</h4>
        </div>
      </div>
    </div>
    <div class="sidebar-menu-wrap">
      <ul class="sidebar-menu toggle-menu list-items">
        <li>
          <a href="admin-dashboard.html"
            ><i class="la la-dashboard mr-2"></i>Tableau de bord</a
          >
        </li>
        <li>
          <a href="admin-dashboard-travellers.html"
            ><i class="la la-users mr-2 text-color-3"></i>Voyageurs</a
          >
        </li>
        <li>
          <a href="admin-dashboard-offers-requests.html"
            ><i class="la la-hand-pointer mr-2 text-color-5"></i>Réservations de séjours</a
          >
        </li>
        <li>
          <span class="side-menu-icon toggle-menu-icon">
            <i class="la la-angle-down"></i>
          </span>
          <a href="admin-dashboard-destinations.html"
            ><i class="la la-directions mr-2 text-color"></i>Destinations</a
          >
          <ul class="toggle-drop-menu">
            <li>
              <a href="admin-dashboard-destinations-add.html">Ajouter destination</a>
            </li>
          </ul>
        </li>
        <li>
          <span class="side-menu-icon toggle-menu-icon">
            <i class="la la-angle-down"></i>
          </span>
          <a href="admin-dashboard-offers.html"
            ><i class="la la-glass-cheers mr-2  text-color-6"></i>Séjours</a
          >
          <ul class="toggle-drop-menu">
            <li>
              <a href="admin-dashboard-offers-add.html">Ajouter Séjour</a>
            </li>
          </ul>
        </li>
        <li class="page-active">
          <a href="admin-dashboard-settings.html"
            ><i class="la la-cog mr-2 text-black"></i>Paramètres</a
          >
        </li>
        <li>
          <a href="admin-login.html" onclick="localStorage.clear();"
            ><i class="la la-power-off mr-2 text-color-10"></i>Se déconnecter</a
          >
        </li>
      </ul>
    </div>
    <!-- end sidebar-menu-wrap -->
  </div>
</div>
<!-- end sidebar-nav -->
<!-- ================================
   END DASHBOARD NAV
================================= -->

<!-- ================================
START DASHBOARD AREA
================================= -->
<section class="dashboard-area">
  <div class="dashboard-nav dashboard--nav">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="menu-wrapper">
            <div class="logo mr-5">
              <a href="index.html"
                ><img style="width: 160px; height: 80px;" src="images/imageedit_42_9895999403-transformed.png" alt="logo"
              /></a>
              <div class="menu-toggler">
                <i class="la la-bars"></i>
                <i class="la la-times"></i>
              </div>
              <!-- end menu-toggler -->
              <div class="user-menu-open">
                <i class="la la-user"></i>
              </div>
              <!-- end user-menu-open -->
            </div>
            <div class="dashboard-search-box">
              <div class="contact-form-action">
                <form action="#">
                  <div class="form-group mb-0">
                    <input
                      class="form-control"
                      type="text"
                      name="text"
                      placeholder="Search"
                    />
                    <button class="search-btn">
                      <i class="la la-search"></i>
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <div class="nav-btn ml-auto">
              <div class="notification-wrap d-flex align-items-center">
              </div>
            </div>
            <!-- end nav-btn -->
          </div>
          <!-- end menu-wrapper -->
        </div>
        <!-- end col-lg-12 -->
      </div>
      <!-- end row -->
    </div>
    <!-- end container-fluid -->
  </div>
  <!-- end dashboard-nav -->
      <div class="dashboard-content-wrap">
        <div class="dashboard-bread dashboard--bread dashboard-bread-2">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <div class="breadcrumb-content">
                  <div class="section-heading">
                    <h2 class="sec__title font-size-30 text-white">Paramètres</h2>
                  </div>
                </div>
                <!-- end breadcrumb-content -->
              </div>
              <!-- end col-lg-6 -->
              <div class="col-lg-6">
                <div class="breadcrumb-list text-right">
                  <ul class="list-items">
                    <li><a href="index.html" class="text-white">Accueil</a></li>
                    <li>Tableau de bord</li>
                    <li>Paramètres</li>
                  </ul>
                </div>
                <!-- end breadcrumb-list -->
              </div>
              <!-- end col-lg-6 -->
            </div>
            <!-- end row -->
          </div>
        </div>
        <!-- end dashboard-bread -->
        <div class="dashboard-main-content">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-12">
                <div class="form-box">
                  <div class="form-title-wrap">
                    <h3 class="title">Information de profile</h3>
                  </div>
                  <div class="form-content">
                    <div
                      class="user-profile-action d-flex align-items-center pb-4"
                    >
                      <div class="user-pro-img">
                        <img src="images/team1.jpg" class="ProfileAI" style="width: 150px; height: 150px;" alt="user-image" />
                      </div>
                      <div class="upload-btn-box">
                        <div class="file-upload-wrap file-upload-wrap-2" id="agentImageProfile">
                          <input
                            id="profileImg"
                            type="file"
                            name="agentImageProfile"
                            class="file-upload-input with-preview"
                            maxlength="1"
                          />
                          <span class="file-upload-text"
                            ><i class="la la-upload mr-2"></i>Upload Image</span
                          >
                          <div class="btn-box">
                            <button class="theme-btn" type="button" onclick="uploadProfileImg()">
                             Changer la photo
                           </button>
                         </div>
                        </div>
                      </div>
                    </div>
                    <div class="contact-form-action">
                      <form id="editAdminProfileForm">
                        <div class="row">
                          <div class="col-lg-6 responsive-column">
                            <div class="input-box">
                              <label class="label-text">admin name</label>
                              <div class="form-group">
                                <span class="la la-user form-icon"></span>
                                <input
                                  id="AgentnameAI3"
                                  class="form-control AgentnameAI3"
                                  type="text"
                                  value="AliTufan"
                                />
                              </div>
                            </div>
                          </div>
                          
                          <!-- end col-lg-6 -->
                          <div class="col-lg-6 responsive-column">
                            <div class="input-box">
                              <label class="label-text">Numéro de téléphone</label>
                              <div class="form-group">
                                <span class="la la-phone form-icon"></span>
                                <input id="PhonePI"
                                  class="form-control"
                                  type="text"
                                  value="+01 4561 3214"
                                />
                              </div>
                            </div>
                          </div>
                          <!-- end col-lg-6 -->
                          <div class="col-lg-12">
                            <div class="btn-box">
                               <button class="theme-btn" type="button" onclick="submitEditAuthForm()">
                                Modifier
                              </button>
                            </div>
                          </div>
                          <!-- end col-lg-12 -->
                        </div>
                        <!-- end row -->
                      </form>
                    </div>
                  </div>
                </div>
                <!-- end form-box -->
              </div>
              <!-- end col-lg-6 -->
              
                          <!-- end col-lg-12 -->
                        </div>
                        <!-- end row -->
                      </form>
                    </div>
                  </div>
                </div>
                <!-- end form-box -->
              </div>
              <!-- end col-lg-6 -->
            </div>
            <!-- end row -->
            <div class="border-top mt-4"></div>
            <div class="row align-items-center">
              <div class="col-lg-7">
                <div class="copy-right padding-top-30px">
                  <p class="copy__desc">
                    Copyright &copy; 2023 Tapis Volant. All Rights Reserved
                  </p>
                </div>
                <!-- end copy-right -->
              </div>
              <!-- end col-lg-7 -->
              <div class="col-lg-5">
                <div class="copy-right-content text-right padding-top-30px">
                  <ul class="social-profile">
                    <li>
                      <a href="#"><i class="lab la-facebook-f"></i></a>
                    </li>
                    <li>
                      <a href="#"><i class="lab la-twitter"></i></a>
                    </li>
                    <li>
                      <a href="#"><i class="lab la-instagram"></i></a>
                    </li>
                    <li>
                      <a href="#"><i class="lab la-linkedin-in"></i></a>
                    </li>
                  </ul>
                </div>
                <!-- end copy-right-content -->
              </div>
              <!-- end col-lg-5 -->
            </div>
            <!-- end row -->
          </div>
          <!-- end container-fluid -->
        </div>
        <!-- end dashboard-main-content -->
      </div>
      <!-- end dashboard-content-wrap -->
    </section>
    <!-- end dashboard-area -->
    <!-- ================================
    END DASHBOARD AREA
================================= -->

    <!-- start scroll top -->
    <div id="back-to-top">
      <i class="la la-angle-up" title="Go top"></i>
    </div>
    <!-- end scroll top -->

    <!-- Template JS Files -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-select.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/daterangepicker.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.countTo.min.js"></script>
    <script src="js/animated-headline.js"></script>
    <script src="js/jquery.multi-file.min.js"></script>
    <script src="js/jquery.ripples-min.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/bootbox.min.js"></script>
    <script>

const editAuth = async () => {
  let headersList = {
    authorization: 'Bearer ' + localStorage.getItem('admintoken'),
    'Content-Type': 'application/json',
    'Cross-Origin-Resource-Policy': 'cross-origin',
  }
  let bodyContent = JSON.stringify({
    username: document.getElementById('AgentnameAI3').value,
    phone: document.getElementById('PhonePI').value,
  })

  let response = await fetch(
    `http://localhost:3000/auth`,
    {
      method: 'PATCH',
      headers: headersList,
      body: bodyContent,
    }
  )

  return await response.json()
}
function phonenumber(inputtxt) {
  var phoneno = /^\+\d{8,14}$/
  if (inputtxt.match(phoneno)) {
    return true
  } else {
    return false
  }
}
const submitEditAuthForm = async () => {
  if (!phonenumber(document.getElementById('PhonePI').value)) {
    let error =
      "Le numéro de téléphone n'est pas correct! la forme accepté: (+33143156455)"
      bootbox.alert(error)
    return {
      error: error,
    }}
  const res = await editAuth()
  console.log(res)
  if (res.data) {
    bootbox.alert({
                    message: 'Votre profil est mis à jour avec succès',
                    className: 'rubberBand animated',
                  })
  }
}
const uploadProfileImgReq = async () => {
  let headersList = {
    authorization: 'Bearer ' + localStorage.getItem('admintoken'),
  }
  let formData = new FormData()

  formData.append('profileImg', document.getElementById('profileImg').files[0])

  let response = await fetch(
    `http://localhost:3000/upload/profile`,
    {
      method: 'POST',
      headers: headersList,
      body: formData,
    }
  )

  return await response.json()
}

const uploadProfileImg = async () => {
  const res = await uploadProfileImgReq()
  if (res.data) {
    bootbox.alert({
                    message: 'Votre photo profil est mis à jour avec succès',
                    className: 'rubberBand animated',
                  })
  }
}

$(document).ready(async () => {
  try {
          var queryString = decodeURIComponent(window.location.search)
          queryString = queryString.substring(8)
          let headersList = {
    authorization: 'Bearer ' + localStorage.getItem('admintoken'),
  }

     const res = await fetch(
    `http://localhost:3000/Fu4mHX5QN6Jd2mpDIMqsd5cMfdLe/me`+queryString,
    {headers: headersList},
  )
  let response = await res.json();
  console.log(response)

          $('.AgentnameAI3').val(response.data.username)
          $('.AgentnameAI3').html(response.data.username)
          $('#PhonePI').val(response.data.phone)
                var path = response.data.profileImg
      var path2 = path.replace(/\\/g, '/')
      console.log(path2)
          $('.ProfileAI').attr(
            'src',
            'http://' + path2
          )
  } catch (error) {
    console.log(error)
  }
})
  </script>
  </body>
</html>
